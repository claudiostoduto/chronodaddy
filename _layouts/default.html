<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  {%- comment -%} Immagine principale (serve anche per OG) {%- endcomment -%}
  {%- assign merc_img = nil -%}
  {%- if page.layout == "mercatino" -%}
    {%- if page.cover and page.cover != "" -%}
      {%- assign merc_img = page.cover -%}
    {%- elsif page.gallery and page.gallery.size > 0 -%}
      {%- assign merc_img = page.gallery[0] -%}
    {%- endif -%}
  {%- endif -%}

  {%- comment -%} TITLE (uno solo) {%- endcomment -%}
  <title>
    {%- if page.layout == "mercatino" and page.seo_title -%}
      {{ page.seo_title }}
    {%- elsif page.title -%}
      {{ page.title }} Â· {{ site.title }}
    {%- else -%}
      {{ site.title }}
    {%- endif -%}
  </title>

  {%- comment -%} DESCRIPTION (una sola) {%- endcomment -%}
  <meta name="description" content="{% if page.layout == 'mercatino' and page.seo_description %}{{ page.seo_description | strip_html | escape }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 | escape }}{% else %}{{ site.description | escape }}{% endif %}" />

  <link rel="canonical" href="{{ page.url | absolute_url }}" />

  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}" />
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS" href="{{ '/feed.xml' | relative_url }}">

  {%- comment -%} Robots per venduti {%- endcomment -%}
  {% if page.layout == "mercatino" and page.status == "venduto" %}
    <meta name="robots" content="noindex,follow">
  {% endif %}

  {%- comment -%} OpenGraph / Twitter {%- endcomment -%}
  <meta property="og:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
  <meta property="og:description" content="{% if page.layout == 'mercatino' and page.seo_description %}{{ page.seo_description | strip_html | escape }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | truncate: 160 | escape }}{% else %}{{ site.description | escape }}{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:type" content="{% if page.layout == 'mercatino' %}product{% else %}website{% endif %}">
  {% if merc_img %}
    <meta property="og:image" content="{{ merc_img | absolute_url }}">
  {% endif %}
  <meta name="twitter:card" content="summary_large_image">

  {%- comment -%} JSON-LD solo per mercatino {%- endcomment -%}
  {% if page.layout == "mercatino" %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": {{ page.title | jsonify }},
    "image": [{% if merc_img %}{{ merc_img | absolute_url | jsonify }}{% endif %}],
    "sku": {{ page.ref | default: page.slug | default: page.name | jsonify }},
    "offers": {
      "@type": "Offer",
      "url": {{ page.url | absolute_url | jsonify }},
      "priceCurrency": {{ page.currency | default: "EUR" | jsonify }},
      "price": {{ page.price_value | default: page.price | jsonify }},
      "availability": "{% if page.status == 'venduto' %}https://schema.org/OutOfStock{% else %}https://schema.org/InStock{% endif %}"
    }
  }
  </script>
  {% endif %}

{%- comment -%} SEO Blog (solo per layout blog-post) {%- endcomment -%}
{% if page.layout == "blog-post" %}

  <meta property="og:type" content="article">
  <meta property="og:title" content="{{ page.title | escape }}">
  <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 | escape }}{% else %}{{ site.description | escape }}{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  {% if page.thumbnail and page.thumbnail != "" %}
    <meta property="og:image" content="{{ page.thumbnail | absolute_url }}">
  {% endif %}

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Article",
    "headline": {{ page.title | jsonify }},
    "datePublished": "{{ page.date | date_to_xmlschema }}",
    "dateModified": "{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}",
    "mainEntityOfPage": { "@type":"WebPage", "@id": {{ page.url | absolute_url | jsonify }} },
    "publisher": { "@type":"Organization", "name": {{ site.title | jsonify }} }
    {% if page.thumbnail and page.thumbnail != "" %},
    "image": [{{ page.thumbnail | absolute_url | jsonify }}]
    {% endif %}
  }
  </script>

{% endif %}

</head>
  <body>
    {% include header.html %}
    <main class="container">
      {{ content }}
    </main>
    {% include footer.html %}
  </body>
</html>
