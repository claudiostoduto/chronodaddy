---
layout: default
---

<article class="merc-single">
  <header class="merc-head">
    <h1>{{ page.title }}</h1>
    <div class="meta">
      {% if page.status == "venduto" %}
        <span class="pill sold">Venduto</span>
      {% else %}
        <span class="pill available">Disponibile</span>
      {% endif %}

      {% if page.date_added %}
        {% assign now_s = 'now' | date: '%s' %}
        {% assign add_s = page.date_added | date: '%s' %}
        {% assign diff = now_s | minus: add_s %}
        {% assign days = diff | divided_by: 86400 %}
        {% if days <= 14 %}
          <span class="pill new">Nuovo</span>
        {% endif %}
      {% endif %}
    </div>
  </header>

  <div class="merc-top">
   <div class="merc-slider" data-slider>
  <button class="merc-nav prev" type="button" aria-label="Foto precedente">‹</button>
  <button class="merc-nav next" type="button" aria-label="Foto successiva">›</button>

  <div class="merc-track" data-track>
    {% for img in page.gallery %}
      <div class="merc-slide" data-slide>
        <img src="{{ img | relative_url }}" alt="">
      </div>
    {% endfor %}
  </div>

  <div class="merc-dots" data-dots>
    {% for img in page.gallery %}
      <button class="dot" type="button" aria-label="Vai alla foto {{ forloop.index }}" data-dot="{{ forloop.index0 }}"></button>
    {% endfor %}
  </div>
</div>

<script>
(function(){
  const root = document.querySelector("[data-slider]");
  if(!root) return;

  const track = root.querySelector("[data-track]");
  const slides = Array.from(root.querySelectorAll("[data-slide]"));
  const dots = Array.from(root.querySelectorAll("[data-dot]"));
  const prev = root.querySelector(".merc-nav.prev");
  const next = root.querySelector(".merc-nav.next");

  let index = 0;

  function setDots(i){
    dots.forEach(d => d.classList.remove("is-active"));
    if(dots[i]) dots[i].classList.add("is-active");
  }

  function go(i, smooth=true){
    index = Math.max(0, Math.min(slides.length - 1, i));
    const left = slides[index].offsetLeft;
    track.scrollTo({ left, behavior: smooth ? "smooth" : "auto" });
    setDots(index);
  }

  // IMPORTANTISSIMO: evita che il browser “ricordi” la slide precedente
  if ("scrollRestoration" in history) {
    history.scrollRestoration = "manual";
  }

  // Forza sempre la prima immagine all’apertura
  track.scrollLeft = 0;
  setDots(0);

  // Dopo che la pagina è stabile, ri-forza la posizione (immagini caricate)
  window.addEventListener("load", () => {
    track.scrollLeft = 0;
    go(0, false);
  });

  prev && prev.addEventListener("click", () => go(index - 1));
  next && next.addEventListener("click", () => go(index + 1));

  dots.forEach(d => {
    d.addEventListener("click", () => go(Number(d.dataset.dot)));
  });

  // Scroll manuale (touch/trackpad): aggiorna solo i dots, NON riscrollare
  let t;
  track.addEventListener("scroll", () => {
    clearTimeout(t);
    t = setTimeout(() => {
      const pos = track.scrollLeft;
      let best = 0, bestDist = Infinity;
      slides.forEach((s, i) => {
        const dist = Math.abs(s.offsetLeft - pos);
        if(dist < bestDist){ bestDist = dist; best = i; }
      });
      index = best;
      setDots(index);
    }, 80);
  }, { passive: true });
})();
</script>
    </div>

    <aside class="merc-info card">
      <div class="price-big">{{ page.price }}</div>

      {% if page.status == "venduto" %}
        <div class="sold-label">VENDUTO</div>
      {% endif %}

      <ul class="specs">
        {% if page.year %}<li><strong>Anno:</strong> {{ page.year }}</li>{% endif %}
        {% if page.condition %}<li><strong>Condizione:</strong> {{ page.condition }}</li>{% endif %}
        {% if page.movement %}<li><strong>Movimento:</strong> {{ page.movement }}</li>{% endif %}
        {% if page.diameter %}<li><strong>Diametro:</strong> {{ page.diameter }}</li>{% endif %}
        {% if page.box_papers %}<li><strong>Dotazione:</strong> {{ page.box_papers }}</li>{% endif %}
        {% if page.location %}<li><strong>Posizione:</strong> {{ page.location }}</li>{% endif %}
      </ul>

      <div class="cta-stack">
        <!-- A) Email -->
        <a class="btn" href="mailto:chronodaddy@mrclaus.xyz?subject={{ 'Info Mercatino: ' | append: page.title | uri_escape }}">
          Richiedi info via Email
        </a>

        <a class="btn ghost"
   href="https://wa.me/393534883914?text={{ 'Ciao! Sono interessato a: ' | append: page.title | append: ' — Link: ' | append: site.url | append: page.url | uri_escape }}"
   target="_blank" rel="noopener">
   Scrivimi su WhatsApp
</a>

<a class="btn ghost"
   href="{{ '/assets/certificati/' | relative_url }}{{ page.slug | default: page.name }}.pdf"
   target="_blank" rel="noopener">
  Scarica certificato (PDF)
</a>

      <p class="meta" style="margin:12px 0 0;">
        *Vendita tra privati. Spedizione e modalità di pagamento da concordare.
      </p>
    </aside>
  </div>

  <div class="merc-description content">
    {{ content }}
  </div>
</article>